<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCA Management Platform</title>
    <link rel="stylesheet" href="/mappingtool/v2/css/styles.css">
</head>
<body>
    <div id="menu"></div>
    <div id="content" class="center-content">
        <!-- Step 1: DCA Loading -->
        <div id="step-1" class="grid-management-section">
            <h2>DCA Management Platform - DCA Loading</h2>
            <div class="upload-section">
                <h3>Upload DCA</h3>
                <input type="file" id="dca-upload" accept=".json,.geojson">
            </div>
            <div class="map-area">
                <p>No DCA loaded. Upload a file to get started.</p>
            </div>
            <div class="navigation-buttons">
                <button id="to-step-2">Next</button>
            </div>
        </div>

        <!-- Combined Steps: Mission Division, Routing Setup, and Area Adjustment -->
        <div id="step-2" class="grid-management-section" style="display: none;">
            <h2>DCA Management Platform - Mission Division</h2>
            <!-- Left Panel for Tools and Drive Conditions -->
            <div class="left-panel" style="float: left; width: 20%; margin-right: 20px;">
                <h3>Tools</h3>
                <button id="draw-square">Square</button>
                <button id="draw-polygon">Polygon</button>
                <button id="move-tool">Move</button>

                <h3>Drive Conditions</h3>
                <label for="weather">Weather:</label>
                <select id="weather">
                    <option value="clear">Clear</option>
                    <option value="rain">Rain</option>
                    <option value="snow">Snow</option>
                </select>

                <label for="traffic">Traffic:</label>
                <select id="traffic">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>

            <!-- Map Area -->
            <div class="map-area" style="float: left; width: 75%;">
                <img src="/mappingtool/v2/images/san_antonio.png" alt="Fake DCA" id="fake-dca" style="max-width: 100%; height: auto;">
                <p>Draw your mission on the map.</p>
            </div>

            <div style="clear: both;"></div>

            <!-- Information Panel -->
            <div class="info-panel">
                <h3>Mission Details</h3>
                <p id="mission-info">No mission defined.</p>
                <button id="request-drive-time">Estimate Drive Time</button>
                <p id="drive-time">Drive time will appear here.</p>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button id="to-step-1">Previous</button>
                <button id="to-step-3">Next</button>
            </div>
        </div>

        <!-- Next Step: Mission Selected -->
        <div id="step-3" class="grid-management-section" style="display: none;">
            <h2>DCA Management Platform - Mission Selected</h2>
            <div class="map-area">
                <img src="/mappingtool/v2/images/san_antonio_mission1.png" alt="Mission Area" id="mission-area" style="max-width: 100%; height: auto;">
                <p id="selected-mission">Selected Mission: San Antonio Mission 1</p>
            </div>
            <div class="info-panel">
                <h3>Drive Time Details</h3>
                <p id="drive-time-summary">Estimated Drive Time: 6 hours</p>
            </div>
            <div class="navigation-buttons">
                <button id="to-step-2">Previous</button>
                <button id="finalize-mission">Finalize Mission</button>
            </div>
        </div>

        <!-- Mission List -->
        <div id="mission-list-section" style="display: none;">
            <h2>Finalized Missions</h2>
            <table id="mission-list">
                <thead>
                    <tr>
                        <th>Mission</th>
                        <th>Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <script>
        let currentMission = 1;
        const missionList = [];

        // Step 1 to Step 2 Navigation
        document.getElementById('to-step-2').addEventListener('click', () => {
            document.getElementById('step-1').style.display = 'none';
            document.getElementById('step-2').style.display = 'block';
            updateMissionDetails();
        });

        // Step 2 to Step 1 Navigation
        document.getElementById('to-step-1').addEventListener('click', () => {
            document.getElementById('step-2').style.display = 'none';
            document.getElementById('step-1').style.display = 'block';
        });

        // Simulate Drawing on Map
        const mapArea = document.getElementById('fake-dca');
        document.getElementById('draw-square').addEventListener('click', () => {
            mapArea.src = `/mappingtool/v2/images/san_antonio_mission${currentMission}.png`;
            document.getElementById('mission-info').textContent = `Mission ${currentMission} Area: Square Drawn`;
        });
        document.getElementById('draw-polygon').addEventListener('click', () => {
            mapArea.src = `/mappingtool/v2/images/san_antonio_mission${currentMission}.png`;
            document.getElementById('mission-info').textContent = `Mission ${currentMission} Area: Polygon Drawn`;
        });

        // Simulate Drive Time Estimation
        document.getElementById('request-drive-time').addEventListener('click', () => {
            const weather = document.getElementById('weather').value;
            const traffic = document.getElementById('traffic').value;
            const driveTime = currentMission === 1 ? '6 hours' : '6 hours 10 minutes';
            document.getElementById('drive-time').textContent = `Estimated Drive Time (Weather: ${weather}, Traffic: ${traffic}): ${driveTime}`;
        });

        // Step 2 to Step 3 Navigation
        document.getElementById('to-step-3').addEventListener('click', () => {
            document.getElementById('step-2').style.display = 'none';
            document.getElementById('step-3').style.display = 'block';
            document.getElementById('mission-area').src = `/mappingtool/v2/images/san_antonio_mission${currentMission}.png`;
            document.getElementById('selected-mission').textContent = `Selected Mission: San Antonio Mission ${currentMission}`;
            document.getElementById('drive-time-summary').textContent = `Estimated Drive Time: ${currentMission === 1 ? '6 hours' : '6 hours 10 minutes'}`;
        });

        // Step 3 to Step 2 Navigation
        document.getElementById('to-step-2').addEventListener('click', () => {
            document.getElementById('step-3').style.display = 'none';
            document.getElementById('step-2').style.display = 'block';
        });

        // Finalize Mission
        document.getElementById('finalize-mission').addEventListener('click', () => {
            const driveTime = currentMission === 1 ? '6 hours' : '6 hours 10 minutes';
            missionList.push({ mission: `Mission ${currentMission}`, time: driveTime });
            updateMissionList();
            alert(`Mission ${currentMission} finalized with selected settings.`);
            currentMission++;
            resetForNextMission();
        });

        // Update Mission List
        function updateMissionList() {
            const missionTableBody = document.querySelector('#mission-list tbody');
            missionTableBody.innerHTML = '';
            missionList.forEach((missionData, index) => {
                const missionRow = document.createElement('tr');
                missionRow.innerHTML = `
                    <td>${missionData.mission}</td>
                    <td>${missionData.time}</td>
                    <td>
                        <button onclick="editMission(${index + 1})">Edit</button>
                        <button onclick="deleteMission(${index + 1})">Delete</button>
                    </td>
                `;
                missionTableBody.appendChild(missionRow);
            });
            document.getElementById('mission-list-section').style.display = 'block';
        }

        // Reset for Next Mission
        function resetForNextMission() {
            document.getElementById('step-3').style.display = 'none';
            document.getElementById('step-2').style.display = 'block';
            document.getElementById('mission-info').textContent = 'No mission defined.';
            document.getElementById('drive-time').textContent = 'Drive time will appear here.';
        }

        // Edit Mission
        function editMission(missionNumber) {
            alert(`Editing Mission ${missionNumber}`);
        }

        // Delete Mission
        function deleteMission(missionNumber) {
            missionList.splice(missionNumber - 1, 1);
            updateMissionList();
        }

        // Update Mission Details
        function updateMissionDetails() {
            document.getElementById('mission-info').textContent = `Prepare Mission ${currentMission}`;
        }
    </script>
</body>
</html>
